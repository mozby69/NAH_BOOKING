
{% extends "nah_template/base.html" %}
{% load static %}
{% block content %}


{% include 'nah_template/navbar.html' %}

<style>
#calendar{
    width:100%;
    height:80vh;
    background-color: white;
    padding:1.5rem;
    border-radius: 1rem;
    color:black;
    margin-top:1.5rem;
}


.main-container{

    background-color: #a4c9a6;
    height:100vh;
    width:100%;
  
}
.container{
    max-width: 100%;

    height:90%;
}
.title{
    font-family: "Raleway", sans-serif;
    font-optical-sizing: auto;
    font-weight: 687;
    font-style: normal;
    margin-top:4rem;
}
.title h2{
    color:white;
    text-align: center;
    

}
.navs{
    margin-top: 4rem;
    display: flex;
    gap:1rem;
    align-items: center;
    justify-content: center;
}
.navs ul{
    list-style-type: none;
   
}
.navs ul a{
    text-decoration: none;
    font-size: 1.2rem;
    color:white;
   
}
.navs ul li {
    background-color: #5EA061;
    padding: .5rem 2rem;
    margin-bottom: .5rem;
    border-radius: 1rem;
    display: flex; /* Make the li element a flex container */
    align-items: center; /* Center vertically */
    justify-content: center; /* Center horizontally */
    line-height: 1.8;
}

.fc-list-day-frame {
    pointer-events: none;
    cursor: default;
}
.fc-list-event:hover {
    background-color: inherit !important;
    color: inherit !important;
}

.fc-event-title {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.navs ul li:hover{
    background-color: white;
    color:#5EA061 !important;
}
.navs ul li a:hover{
    color:#5EA061;
}
table {
            width: 100%;
            border-collapse: collapse;
            font-size:.9rem;
    
        }
        th, td {
            border: 1px solid #000;
            padding: 8px;
            text-align: left;
            border:none;
        }
        th {
            background-color: #f2f2f2;
            border:1px solid gray;
        }
        .table-container {
            max-height: 500px; /* Set the desired maximum height */
            overflow-y: auto; /* Enable vertical scrolling */
            overflow-x: hidden; /* Hide horizontal scrolling if not needed */
        }
.arrows button{
    border:none;
    padding:.5rem 1rem;
}


</style>
    <!-- google fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,687;1,687&display=swap" rel="stylesheet">
    <!-- google icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <!-- fullcalendar -->
{% comment %} 
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet"> {% endcomment %}

<div class="main-container">


    <div class="container">

        <div class="row"> 
            <div class="col-2 title">
                <h2>Weekly<br> Overview</h2>

                <div class="navs">
                    <ul>
                        <li><a href="{% url 'pspmi_main_page' %}" style="font-size:clamp(.1rem,1rem,1.5rem);text-align: center;"><span class="material-symbols-outlined" style="position: relative;top:.3rem;right:.5rem;">library_books</span>Book Event</a></li>
                        <li><a href="{% url 'pspmi_view_page' %}" style="font-size:clamp(.1rem,1rem,1.5rem);text-align: center;"><span class="material-symbols-outlined" style="position: relative;top:.3rem;right:.5rem;">book</span>Monthly </a></li>
                        <li><a href="{% url 'pspmi_monthly_page' %}" style="font-size:clamp(.1rem,1rem,1.5rem);text-align: center;"><span class="material-symbols-outlined" style="position: relative;top:.3rem;right:.5rem;">note_stack</span>Weekly </a></li>
                        <li><a href="{% url 'pspmi_yearly_page' %}" style="font-size:clamp(.1rem,1rem,1.5rem);text-align: center;"><span class="material-symbols-outlined" style="position: relative;top:.3rem;right:.5rem;">view_timeline</span>Yearly </a></li>
                      
                        <li><a href="{% url 'booking_reports' %}" style="font-size:clamp(.1rem,1rem,1.5rem);text-align: center;"><span class="material-symbols-outlined" style="position: relative;top:.3rem;right:.5rem;">view_timeline</span>Reports</a></li>
                      
                    </ul>
                </div>

            </div>

            <div class="col-10 mt-5">






                <form id="filterForm" method="POST" action="">
                    <div class="row px-2">
                        <div class="col-md-3">
                            <div class="d-flex justify-content-start">
                                <select id="categoryFilter" class="form-control filterbutton" name="category" style="margin-right:1rem;">
                                    <option value="">All Categories</option>
                                    <option value="function_hall">Function Hall</option>
                                    <option value="pavilion">Pavilion</option>
                                    <option value="hostel">Hostel</option>
                                    <option value="basketball_court">Basketball Court</option>
                                    <option value="cabana">Cabana</option>
                                    <option value="camp_site">Camp Site</option>
                                    <option value="big_pool">Big Pool</option>
                                    <option value="kidney_pool">Kidney Pool</option>
                                </select>
                                <button type="submit" class="ml-5 btn btn-primary" style="padding:0 1.5rem;font-weight:bold;">Filter</button>
                 
                            </div>
                        </div>
                    </div>
                </form>
                






               
                <div id="calendar">

                    <div class="maincontainer">

                        <div class="arrows" style="margin-bottom:1rem;display:flex;gap:.5rem;justify-content: space-between;">
                            
                            <div class="buttons">
                                <button onclick="navigateWeek(-1)" class="ml-5 btn btn-primary" style="font-weight:bold;"><</button>
                                <button onclick="navigateWeek(1)" class="ml-5 btn btn-primary" style="font-weight:bold;">></button>
                                <button type="button" onclick="redirectToPrintPage()" class="ml-5 btn btn-secondary" style="background-color:green;color:white;font-weight:bold;margin-left:1.5rem;border-radius:.5rem;">Print</button>

                                {% comment %} <button onclick="redirectToPrintPage()" style="background-color:green;color:white;font-weight:bold;margin-left:1.5rem;border-radius:.5rem;">Print</button> {% endcomment %}
    
                            </div>
             
                            <div class="weekname" style="margin-right: 3rem;">
                                <h4 id="weekRange">{{ week_start_display }} - {{ week_end_display }}</h4>
                            </div>

                        </div>
               
                    
                        <div class="table-container">
                            <table class="table table-bordered table-hover tables">
                                <thead>
                                    <tr>
                                        <th>Day</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Start Time</th>
                                        <th>End Time</th>
                                       
                                        <th>Category</th>
                                        <th>Client Name</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for day, events in grouped_events.items %}
                                        {% if events %}
                                            {% for event in events %}
                                                <tr>
                                                    {% if forloop.first %}
                                                        <th rowspan="{{ events|length }}">{{ day }}</th>
                                                      
                                                    {% endif %}
                                                    <td>{{ event.date_start }}</td>
                                                    <td>{{ event.date_end }}</td>
                                                    <td>{{ event.start_time }}</td>
                                                    <td>{{ event.end_time }}</td>
                                                    
                                                    <td>{{ event.category }}</td>
                                                    <td>{{ event.name }}</td>
                                                </tr>

                                               
                                            {% endfor %}
                                            <tr>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                        {% else %}
                                            <tr>
                                                <th>{{ day }}</th>
                                                <td colspan="6">No events</td>
                                            </tr>
                                        {% endif %}
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    

                    </div> 
               
                </div>
            </div>


           
        </div>
      
    </div>

</div>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get the current URL's query parameters
        const queryParams = new URLSearchParams(window.location.search);
        const selectedCategory = queryParams.get('category') || '';

        // Set the selected option based on the URL parameter
        const categoryFilter = document.getElementById('categoryFilter');
        if (categoryFilter) {
            categoryFilter.value = selectedCategory;
        }
    });
</script>


<script>
    function navigateWeek(offset) {
        const currentWeekStart = new Date("{{ week_start|date:'F j, Y' }}");
        const currentWeekEnd = new Date("{{ week_end|date:'F j, Y' }}");

        const newWeekStart = new Date(currentWeekStart);
        newWeekStart.setDate(currentWeekStart.getDate() + (offset * 7));
        newWeekStart.setDate(newWeekStart.getDate() - newWeekStart.getDay() + 1);

        const newWeekEnd = new Date(newWeekStart);
        newWeekEnd.setDate(newWeekStart.getDate() + 6);

        const startString = formatDate(newWeekStart);
        const endString = formatDate(newWeekEnd);

        const category = document.getElementById('categoryFilter').value;
        window.location.href = `/pspmi_weekly/?week_start=${startString}&week_end=${endString}&category=${category}`;
    }

    function formatDate(date) {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        return date.toLocaleDateString('en-US', options);
    }

    function formatWeekRange(startDate, endDate) {
        const startMonth = startDate.toLocaleString('default', { month: 'long' });
        const endMonth = endDate.toLocaleString('default', { month: 'long' });
        const startDay = startDate.getDate();
        const endDay = endDate.getDate();
        return `${startMonth} ${startDay} - ${endMonth} ${endDay}`;
    }

    document.addEventListener('DOMContentLoaded', function() {
        const weekStart = new Date("{{ week_start|date:'F j, Y' }}");
        const weekEnd = new Date("{{ week_end|date:'F j, Y' }}");
        const weekRangeText = formatWeekRange(weekStart, weekEnd);
        document.getElementById('weekRange').textContent = weekRangeText;

        document.getElementById('filterForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const category = document.getElementById('categoryFilter').value;
            const currentWeekStart = formatDate(weekStart); // Ensure this format matches the backend
            const currentWeekEnd = formatDate(weekEnd); // Ensure this format matches the backend
            $(".filterbutton").val(category);
            x = category
            window.location.href = `/pspmi_weekly/?week_start=${encodeURIComponent(currentWeekStart)}&week_end=${encodeURIComponent(currentWeekEnd)}&category=${encodeURIComponent(x)}`;
        });




        
    });

    document.addEventListener('DOMContentLoaded', function() {
        const categoryFilter = document.getElementById('categoryFilter');
        const currentCategory = document.getElementById('currentCategory');

        // Initialize hidden input with current filter value
        if (categoryFilter && currentCategory) {
            currentCategory.value = categoryFilter.value;
        }
    });

    function redirectToPrintPage() {
        const category = document.getElementById('categoryFilter').value;

        // Get the current week start and end dates
        const weekStart = "{{ week_start|date:'F j, Y' }}";
        const weekEnd = "{{ week_end|date:'F j, Y' }}";


        // Redirect to print page with current filter values
        window.location.href = `/pspmi_print_page/?week_start=${encodeURIComponent(weekStart)}&week_end=${encodeURIComponent(weekEnd)}&category=${encodeURIComponent(category)}`;
    }
    
    
</script>



{% endblock content %}